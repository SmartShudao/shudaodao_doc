# ShuDaodao 配置文件说明

## 目录结构

```
configs/
├── base.yaml          # 基础配置
├── dev.yaml           # 开发环境配置
├── prod.yaml          # 生产环境配置
├── environment.yaml   # 用于检查配置
└── secrets/           # 敏感配置
    ├── dev.yaml
    └── prod.yaml
```

## 检查配置(environment.yaml)

- **产生条件**
    - 只有 show_merge_yaml: true  时才会产生
- **文件用途**
    - 开发环境 用于检查最终加载的配置内容

## 基础配置 (base.yaml)

```yaml
SmartShudao:
  # 运行环境配置 (必填)
  # 可选值: "dev" - 开发环境, "prod" - 生产环境
  environment: "dev"

  # 网站基础配置 (可扩展)
  webapp: { }

  # 存储配置 (数组格式)
  storage: [ ]

  # AI模型配置 (数组格式)
  models: [ ]
```

## 配置加载机制

### **加载顺序**：

- 基础配置
    - `base.yaml`
    - 根据 `environment` 值 `dev`、`prod`  加载对应环境配置
- 环境配置
    - `[environment].yaml` 如: dev.yaml 
- 敏感配置
    - `secrets/[environment].yaml` 如:secrets/prod.yaml

graph LR
A[base.yaml] --> B{environment}
B -->|dev| C[dev.yaml] --> D[secrets/dev.yaml]
B -->|prod| E[prod.yaml] --> F[secrets/prod.yaml]

### **合并规则**：

- 后加载的配置会深度合并先加载配置
- 同名字段会以后加载的值为准

| 合并类型  | 	说明        |                                                     	示例 |
|-------|------------|--------------------------------------------------------:|
| 深度合并  | 	递归合并嵌套字段	 | website: {host: "0.0.0.0"} + website: {port: 80} → 保留两者 |
| 覆盖替换	 | 同名字段直接替换   |     website: {port: 80} + website:{port: 8080}  -> 保留后者 |

## **敏感数据管理**

### 文件规范

| 文件                | 保密要求   | 示例内容                                                     |
|-------------------|--------|----------------------------------------------------------|
| secrets/dev.yaml  | 禁止版本控制 |                                                          |
| secrets/prod.yaml | 加密存储   | yaml\ndb_url: "postgres://user:${ENV_VAULT_PWD}@prod-db" |

### 安全实践

```text
# 正确做法
password: "${DB_PASSWORD}"

# 禁止做法
password: "plaintext123"
```

