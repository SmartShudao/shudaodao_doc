## TOTP

基于时间的一次性密码算法(TOTP, Time-based One-Time Password

## 一、工作流程

### 1. 密钥共享(Secret Key)

- 当用户启用“身份验证器”时，系统会生成一个唯一的密钥(通常以二维码形式展示)。
- 用户使用“腾讯身份验证器”小程序扫描该二维码，小程序将该密钥安全地存储在本地设备中。
- 这个密钥是用户账户与验证器之间的共享密钥，不会上传到腾讯服务器(除非用户主动备份)。

### 2. 动态口令生成

- 小程序使用该密钥和当前时间戳，通过 HMAC-SHA1 算法计算出一个一次性密码。 
- 最终生成一个 6 位数字的动态验证码(如 123456)，每 30 秒刷新一次。

### 3. 服务器验证

- 当用户登录时输入当前的 6 位动态码
- 服务器使用相同的密钥和时间窗口(通常允许 ±1 个周期，即前后 30 秒)进行计算。
- 如果客户端和服务器生成的验证码匹配，则认证通过。

## 二、技术特点

| 特性   | 说明                               |
|------|----------------------------------|
| 离线运行 | 验证码生成不依赖网络，仅需设备时间准确。             |
| 同步机制 | 依赖设备时间与服务器时间的同步(通常要求误差在 ±1 分钟内)。 |
| 防泄露  | 即使某个验证码被截获，也无法用于下次登录。            |

## 三、与短信验证码的对比

| 对比项      | 	TOTP(身份验证器) | 	短信验证码    |
|----------|--------------|-----------|
| 是否依赖网络   | 否(仅生成时)      | 是(需接收短信)  |
| 抵抗SIM卡劫持 | ✅ 强          | ❌ 弱(易被劫持) |
| 成本       | 无(一次性设置)     | 每次发送有成本   |
| 可用性      | 设备(手机)在即可使用  | 需信号良好     |
| 安全性      | 更高           | 相对较低      |


	